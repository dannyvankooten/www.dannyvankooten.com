<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/styles.css?v=202310222">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="icon" href="/img/favicon.png" type="image/png">
    <title>Only load Contact Form 7 scripts when needed</title>
    <link rel="canonical" href="https://www.dannyvankooten.com/blog/2013/only-load-contact-form-7-scripts-when-needed/">
</head>
<body>
<header class="site-header">
    <nav class="container">
        <ul>
            <li class="home"><a href="/" rel="home">Danny van Kooten</a></li>
            <li><a href="/about/">About me</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="/contact/">Contact</a></li>
        </ul>
    </nav>
</header>
<main>
    <div class="container">


<h1>Only load Contact Form 7 scripts when needed</h1>

<p class="muted">Published <time datetime="2013-12-14">2013-12-14</time> on <a href="https://www.dannyvankooten.com/blog/2013/only-load-contact-form-7-scripts-when-needed/">Permalink</a></p>


<p>For the second year in a row, Elliot Richmond is hosting <a href="http://advent.squareonemd.co.uk/">WordPress Snippets Til Christmas</a>. The name says it pretty much: a useful WordPress snippet a day, until Christmas. Very useful, for both starters as experienced WordPress nerds.</p>
<p>I decided to get in on the fun and contributed <a href="http://advent.squareonemd.co.uk/prevent-loading-unnecessary-scripts-and-styles-in-wordpress/">a snippet explaining how to only load Contact Form 7 scripts and styles on pages that actually have a form in them</a>.</p>
<p>This is what the snippet does:</p>
<ol>
	<li>It checks if the requested page is a post, page or attachment.</li>
	<li>Then, it checks if the post or page contains the <code>contact-form-7</code> shortcode.</li>
	<li>If either one of the above statements is not true, it will tell WordPress not to load the Contact Form 7 styles and scripts.</li>
</ol>
<pre><code class="language-php?start_inline=1">function dvk_dequeue_scripts() {

    $load_scripts = false;

    if( is_singular() ) {
    	$post = get_post();

    	if( has_shortcode($post-&gt;post_content, 'contact-form-7') ) {
        	$load_scripts = true;
    	}

    }

    if( ! $load_scripts ) {
        wp_dequeue_script( 'contact-form-7' );
        wp_dequeue_style( 'contact-form-7' );
    }

}

add_action( 'wp_enqueue_scripts', 'dvk_dequeue_scripts', 99 );
</code></pre>
<p>Be careful when implementing a snippet like this. If you (or your client) show a contact form using a template function or widget, the form will be missing its scripts and styles.</p>
<p>Also, if you're worrying about stuff like this, make sure you have proper caching set up. Caching, combining and minifying resources will give you a much bigger performance boost.</p>
<h3>Plugin developers: load your scripts in the footer</h3>
In most cases, it makes sense to load your plugin scripts in the footer. This also has the benefit you can only add them to the footer if your plugin actually needs them. 
<p>Just call <a href="https://codex.wordpress.org/Function_Reference/wp_enqueue_script"><code>wp_enqueue_scripts</code></a> from your display function (your shortcode callback, template function, ...) and set the last parameter <code>$in_footer</code> to <code>true</code>.</p>
<p>I usually register the script as early as possible so users have the chance to replace them, should they want to.</p>
<pre><code class="language-php?start_inline=1">// on plugin initialization
wp_register_script( 'script-name', get_template_directory_uri() . '/js/script.js', array(), '1.0', true );

// your shortcode callback, widget display function, etc..
function my_display_function($attr = array(), $content = '') {
	wp_enqueue_script('script-name');
}
</code></pre>
<p>Did I miss anything? Don't hesitate to correct me in the comments. :-)</p>


</div>
</main>
<footer class="container site-footer">
    <div class="footer-col mb">
        <ul class="nolist">
            <li><a href="/about/" style="font-weight: bold; text-decoration: none;">About me</a></li>
            <li><a href="/bookmarks/">Bookmarks</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="/code/">Code</a></li>
            <li><a href="/contact/">Contact me</a></li>
        </ul>
    </div>
    <div class="footer-col mb">
        <ul class="nolist">
            <li><a href="/projects/" style="font-weight: bold; text-decoration: none;">Projects</a></li>
            <li><a href="https://www.mc4wp.com/">Mailchimp for WordPress</a></li>
            <li><a href="https://www.kokoanalytics.com/">Koko Analytics</a></li>
            <li><a href="https://www.htmlformsplugin.com/">HTML Forms plugin</a></li>
        </ul>
    </div>
    <p style="clear:both;">Find me on <a href="https://git.sr.ht/~dvko/" class="icon sourcehut" rel="me nofollow author">sourcehut</a>,
        <a href="https://github.com/dannyvankooten/" class="icon github" rel="me nofollow author">GitHub</a> and <a rel="me" href="https://toot.re/@dvk" class="icon mastodon">Mastodon</a>.
    </p>
    <p>This website is statically built using <a href="https://www.getzola.org/">Zola</a>. You can find <a href="https://git.sr.ht/~dvko/dannyvankooten.com" rel="nofollow">its source code here</a>.</p>
    <p>Pageviews for this site are counted using a standalone spin-off of Koko Analytics, code-named <a href="https://teller.dvk.co/">Teller</a>.</p>
</footer>
<script>
    ((t, cnf) => {
        window[t] = cnf;
        let s = document.createElement('script');
        s.defer = true;
        s.src = [cnf.url, '/assets/', t, '.min.js'].join('');
        document.body.appendChild(s)
    })('teller', {
        url: 'https://teller.dvk.co',
        site: '433ca337-2a49-4391-a340-e3c3bbbb32d3'
    })
</script>
</body>
</html>

