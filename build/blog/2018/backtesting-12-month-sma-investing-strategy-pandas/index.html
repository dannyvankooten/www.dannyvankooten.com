<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/styles.css?v=202310222">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="icon" href="/img/favicon.png" type="image/png">
    <title>Backtesting 12-month SMA investing strategy with Pandas</title>
    <link rel="canonical" href="https://www.dannyvankooten.com/blog/2018/backtesting-12-month-sma-investing-strategy-pandas/">
</head>
<body>
<header class="site-header">
    <nav class="container">
        <ul>
            <li class="home"><a href="/" rel="home">Danny van Kooten</a></li>
            <li><a href="/about/">About me</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="/contact/">Contact</a></li>
        </ul>
    </nav>
</header>
<main>
    <div class="container">


<h1>Backtesting 12-month SMA investing strategy with Pandas</h1>

<p class="muted">Published <time datetime="2018-01-24">2018-01-24</time> on <a href="https://www.dannyvankooten.com/blog/2018/backtesting-12-month-sma-investing-strategy-pandas/">Permalink</a></p>


<p>In my quest to learn more about investing, I came across <a href="https://ofdollarsanddata.com/follow-the-money-eb1ae0c9a3bd">this post</a>.  The author writes <em>&quot;How One Simple Rule Can Beat Buy and Hold Investing&quot;</em> and then explains how following the trend is likely to beat a more traditional buy and hold investment approach.</p>
<p>Intrigued, I decided to dive into the data to see if I could replicate his results.</p>
<p>In this post I'll walk you through the code and results for backtesting a 12-month simple moving average trend strategy on S&amp;P 500 stock market data.</p>
<p>We'll compare entering the market when it is trending up and moving to cash when it is trending down to simply staying invested at all times. The latter approach is known as buy &amp; hold, or <a href="https://en.wikipedia.org/wiki/HODL">HODL</a> depending on what corner of the internet you're from.</p>
<h3>Obtaining data on daily closing prices for the S&amp;P 500</h3>
<p>First things first, we need data.</p>
<p>Yahoo Finance provides us with <a href="https://finance.yahoo.com/quote/%5EGSPC/history?p=%5EGSPC">historical data for the S&amp;P 500 as far back as 1960</a>. Let's start out with parsing the CSV download into a DataFrame so we can get to work.</p>
<pre><code class="language-py">%matplotlib inline
import pandas as pd

sp500 = pd.read_csv('data/SP500.csv', sep=',', parse_dates=True, index_col='Date', usecols=['Adj Close', 'Date'])
sp500.head()
</code></pre>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>Adj Close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1960-01-04</th>
      <td>59.910000</td>
    </tr>
    <tr>
      <th>1960-01-05</th>
      <td>60.389999</td>
    </tr>
    <tr>
      <th>1960-01-06</th>
      <td>60.130001</td>
    </tr>
    <tr>
      <th>1960-01-07</th>
      <td>59.689999</td>
    </tr>
    <tr>
      <th>1960-01-08</th>
      <td>59.500000</td>
    </tr>
  </tbody>
</table>
</div>
<h3>Calculating the 12 month simple moving average</h3>
<p>To test our trend strategy later on, we need the daily change (in %) and the 12-month simple moving average.</p>
<pre><code class="language-py">sp500['Pct Change'] = sp500['Adj Close'].pct_change()
sp500['SMA 365'] = sp500['Adj Close'].rolling(window=365).mean()
sp500.dropna().head()
</code></pre>
<div style="overflow-x: auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Date</th>
      <th>Adj Close</th>
      <th>Pct Change</th>
      <th>SMA 365</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1961-06-14</th>
      <td>65.980003</td>
      <td>0.002736</td>
      <td>58.350521</td>
    </tr>
    <tr>
      <th>1961-06-15</th>
      <td>65.690002</td>
      <td>-0.004395</td>
      <td>58.366356</td>
    </tr>
    <tr>
      <th>1961-06-16</th>
      <td>65.180000</td>
      <td>-0.007764</td>
      <td>58.379479</td>
    </tr>
    <tr>
      <th>1961-06-19</th>
      <td>64.580002</td>
      <td>-0.009205</td>
      <td>58.391671</td>
    </tr>
    <tr>
      <th>1961-06-20</th>
      <td>65.150002</td>
      <td>0.008826</td>
      <td>58.406630</td>
    </tr>
  </tbody>
</table>
</div>
<p>This leaves us with all the data we need to compare our two investment strategies.</p>
<h3>Defining the trend strategy</h3>
<p>To recap, we want to invest when the trend is moving up, ie when the stock price is higher than the average price over the last 12 months. When the stock is traded at a price lower than the moving average, we move to cash.</p>
<p>Let's add a column to our dataframe indicating whether the criteria for our trend strategy is met.</p>
<pre><code class="language-py">sp500['Criteria'] = sp500['Adj Close'] &gt;= sp500['SMA 365'] 
sp500['Criteria'].value_counts() 
</code></pre>
<pre><code class="language-text">True     10577
False     4032
Name: Criteria, dtype: int64
</code></pre>
<p>This tells us that on our entire dataset, our criteria was met on 10577 of the market's trading days.</p>
<h3>Calculating our investment return</h3>
<p>To calculate the return for our benchmark buy &amp; hold strategy, all we need to do is calculate the cumulative product of the daily change in prices.</p>
<p>Let's assume an initial investment of $100 and calculate the return if we were to hold for the entire time period.</p>
<pre><code class="language-py">sp500['Buy &amp; Hold'] = 100 * (1 + sp500['Pct Change']).cumprod()
</code></pre>
<p>To calculate the return for our strategy, we should only add the compounded return for the days on which we are actually in the market.</p>
<p>On all other days the cash value of our investment remains unchanged.</p>
<pre><code class="language-py">sp500['Trend'] = 100 * (1 + ( sp500['Criteria'].shift(1) * sp500['Pct Change'] )).cumprod()
</code></pre>
<p>Let's plot the values of both strategies in a single graph so that we can compare performances.</p>
<pre><code class="language-py">ax = sp500[['Trend', 'Buy &amp; Hold']].plot(grid=True, kind='line', title=&quot;Trend (12 month SMA) vs. Buy &amp; Hold&quot;, logy=True)
</code></pre>
<p><img src="/media/2018/buy-and-hold-vs-trend-sma-365.png" alt="12-month SMA vs Buy &amp; Hold"></p>
<p>This shows us that <strong>a simple buy &amp; hold investing approach actually outperformed our trend strategy when looking at the S&amp;P 500 market data for 1960 to early 2018</strong>.</p>
<h3>Seeking outperformance</h3>
<p>Looking at the graph above, you can see that the trend did well during ongoing bear markets but sometimes failed to pick up on quick market recoveries.</p>
<p>So let's cheat a little and look at just &quot;the lost decade&quot;, which contains not just one but two relatively long bear markets!</p>
<p><img src="/media/2018/buy-and-hold-vs-sma-365-2000s.png" alt=""></p>
<p>This shows us that our trend strategy resulted in considerable outperformance during these 2 decades, but only because of the two bear markets.</p>
<h3>Conclusion: Trend following over Buy &amp; Hold?</h3>
<p>After playing with the data and looking at performance of the 2 strategies over different time periods, I think it's safe to say that simple buy and hold is the way to go for most individual investors. Especially as the above does not take transaction costs into account just yet.</p>
<p>With some hindsight we can make the trend following model outperform, but in real life we obviously do not have that luxury. Luckily, buy and hold has always made up for the difference in returns, even if you bought in just before 2 decades of bear markets.</p>
<p><em>You can <a href="https://github.com/dannyvankooten/dannyvankooten.com/blob/master/static/notebooks/12%20month%20SMA%20vs%20Buy%20and%20Hold.ipynb">find the complete Jupyter Notebook for this post here</a>.</em></p>


</div>
</main>
<footer class="container site-footer">
    <div class="footer-col mb">
        <ul class="nolist">
            <li><a href="/about/" style="font-weight: bold; text-decoration: none;">About me</a></li>
            <li><a href="/bookmarks/">Bookmarks</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="/code/">Code</a></li>
            <li><a href="/contact/">Contact me</a></li>
        </ul>
    </div>
    <div class="footer-col mb">
        <ul class="nolist">
            <li><a href="/projects/" style="font-weight: bold; text-decoration: none;">Projects</a></li>
            <li><a href="https://www.mc4wp.com/">Mailchimp for WordPress</a></li>
            <li><a href="https://www.kokoanalytics.com/">Koko Analytics</a></li>
            <li><a href="https://www.htmlformsplugin.com/">HTML Forms plugin</a></li>
        </ul>
    </div>
    <p style="clear:both;">Find me on <a href="https://git.sr.ht/~dvko/" class="icon sourcehut" rel="me nofollow author">sourcehut</a>,
        <a href="https://github.com/dannyvankooten/" class="icon github" rel="me nofollow author">GitHub</a> and <a rel="me" href="https://toot.re/@dvk" class="icon mastodon">Mastodon</a>.
    </p>
    <p>This website is statically built using <a href="https://www.getzola.org/">Zola</a>. You can find <a href="https://git.sr.ht/~dvko/dannyvankooten.com" rel="nofollow">its source code here</a>.</p>
    <p>Pageviews for this site are counted using a standalone spin-off of Koko Analytics, code-named <a href="https://teller.dvk.co/">Teller</a>.</p>
</footer>
<script>
    ((t, cnf) => {
        window[t] = cnf;
        let s = document.createElement('script');
        s.defer = true;
        s.src = [cnf.url, '/assets/', t, '.min.js'].join('');
        document.body.appendChild(s)
    })('teller', {
        url: 'https://teller.dvk.co',
        site: '433ca337-2a49-4391-a340-e3c3bbbb32d3'
    })
</script>
</body>
</html>

