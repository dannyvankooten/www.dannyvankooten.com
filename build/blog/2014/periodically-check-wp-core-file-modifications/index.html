<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/styles.css?v=202310222">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="icon" href="/img/favicon.png" type="image/png">
</head>
<body>
<header class="site-header">
    <nav class="container">
        <ul>
            <li class="home"><a href="/" rel="home">Danny van Kooten</a></li>
            <li><a href="/about/">About me</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="/contact/">Contact</a></li>
        </ul>
    </nav>
</header>
<main>
    <div class="container">

<h1>Periodically check WordPress core for (malicious) modifications</h1>
    <p>Last Thursday I was at a WordPress meetup where <a href="https://www.jaimemartinez.nl/">Jaime Martinez</a> did a talk about <a href="https://wp-cli.org/">WP-CLI</a>, a command line interface for WordPress.</p>
<p>One of the very useful commands he showed is <code>wp core verify-checksums</code>, which verifies the checksum of all WordPress core files. It will tell you exactly which of your core files do not match the original file in the WordPress.org repository.</p>
<pre><code class="language-txt">$ wp core verify-checksums
Warning: File does not verify against checksum: wp-admin/about.php
Warning: File does not verify against checksum: wp-load.php
Error: WordPress install does not verify against checksums.
</code></pre>
<p>Running this command at a set interval can be very useful to monitor your WordPress installations for malicious modifications.</p>
<p>I configured a cronjob on my server to run the following script every day.</p>
<pre><code class="language-sh">#!/bin/bash
cd /my/wp/directory

if [ -e /tmp/wp-core-verify-checksums-notified ]; then
	exit
fi

if [ ! $(wp core verify-checksums) ]; then
	curl https://api.pushbullet.com/api/pushes \
	      -u MY_API_KEY: \
	      -d type=note \
	      -d title=&quot;WP checksum verification failed.&quot; \
	      -d body=&quot;Checksum of your WP core files does not match the checksum of original core files. What up with that?&quot; \
	      -X POST

	touch /tmp/wp-core-verify-checksums-notified
fi
</code></pre>
<p>It traverses into my WordPress directory and runs the WP-CLI command. If verification failed it will send a push notification to all my devices using <a href="https://www.pushbullet.com/">Pushbullet</a>.</p>
<p>If you ask me it is definitely worth a few minutes of your time to configure something along the same lines for your server(s) or customers.</p>
<p>Tips or improvements? Taking this a step further? Sharing is caring! :-)</p>

</div>
</main>
<footer class="container site-footer">
    <div class="footer-col mb">
        <ul class="nolist">
            <li><a href="/about/" style="font-weight: bold; text-decoration: none;">About me</a></li>
            <li><a href="/bookmarks/">Bookmarks</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="/code/">Code</a></li>
            <li><a href="/contact/">Contact me</a></li>
        </ul>
    </div>
    <div class="footer-col mb">
        <ul class="nolist">
            <li><a href="/projects/" style="font-weight: bold; text-decoration: none;">Projects</a></li>
            <li><a href="https://www.mc4wp.com/">Mailchimp for WordPress</a></li>
            <li><a href="https://www.kokoanalytics.com/">Koko Analytics</a></li>
            <li><a href="https://www.htmlformsplugin.com/">HTML Forms plugin</a></li>
        </ul>
    </div>
    <p style="clear:both;">Find me on <a href="https://git.sr.ht/~dvko/" class="icon sourcehut" rel="me nofollow author">sourcehut</a>,
        <a href="https://github.com/dannyvankooten/" class="icon github" rel="me nofollow author">GitHub</a> and <a rel="me" href="https://toot.re/@dvk" class="icon mastodon">Mastodon</a>.
    </p>
    <p>This website is statically built using <a href="https://www.getzola.org/">Zola</a>. You can find <a href="https://git.sr.ht/~dvko/dannyvankooten.com" rel="nofollow">its source code here</a>.</p>
    <p>Pageviews for this site are counted using a standalone spin-off of Koko Analytics, code-named <a href="https://teller.dvk.co/">Teller</a>.</p>
</footer>
<script>
    ((t, cnf) => {
        window[t] = cnf;
        let s = document.createElement('script');
        s.defer = true;
        s.src = [cnf.url, '/assets/', t, '.min.js'].join('');
        document.body.appendChild(s)
    })('teller', {
        url: 'https://teller.dvk.co',
        site: '433ca337-2a49-4391-a340-e3c3bbbb32d3'
    })
</script>
</body>
</html>

