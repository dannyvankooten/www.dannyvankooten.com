<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/styles.css?v=202310222">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="icon" href="/img/favicon.png" type="image/png">
    <title>Replacing annotations with PHP attributes - with Rector</title>
    <link rel="canonical" href="https://www.dannyvankooten.com/blog/2023/rector-annotations-to-attributes/">
</head>
<body>
<header class="site-header">
    <nav class="container">
        <ul>
            <li class="home"><a href="/" rel="home">Danny van Kooten</a></li>
            <li><a href="/about/">About me</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="/contact/">Contact</a></li>
        </ul>
    </nav>
</header>
<main>
    <div class="container">


<h1>Replacing annotations with PHP attributes - with Rector</h1>

<p class="muted">Published <time datetime="2023-07-10">2023-07-10</time> on <a href="https://www.dannyvankooten.com/blog/2023/rector-annotations-to-attributes/">Permalink</a></p>


<p>Recently I was updating a Symfony application to version 6.3 and working my way through all deprecations. One of them was the move to native <a href="https://www.php.net/manual/en/language.attributes.overview.php">PHP attributes</a> (introduced in PHP8) instead of annotations supported by the Doctrine Annotations library.</p>
<p>Doing this manually would cost quite a few tedious hours. Luckily, it's 2023 and static analysis tools have been getting better and better, at least in the PHP ecosystem.</p>
<h2>Rector - automated refactoring</h2>
<p><a href="https://getrector.com/documentation">Rector</a> is a tool for automated refactoring of PHP code. It can handle a wide variety of changes on a language level and also supports upgrades for some of the more popular frameworks.</p>
<p>For example, <a href="https://getrector.com/blog/how-to-upgrade-annotations-to-attributes">having Rector replace all annotations with PHP8 attributes</a> was as simple as this:</p>
<ol>
<li>Install Rector</li>
</ol>
<pre><code class="language-php">composer require rector/rector --dev
</code></pre>
<ol start="2">
<li>Create a configuration file called <code>rector.php</code></li>
</ol>
<pre><code class="language-php">&lt;?php

declare(strict_types=1);

use Rector\Config\RectorConfig;
use Rector\CodeQuality\Rector\Class_\InlineConstructorDefaultToPropertyRector;
use Rector\Php80\Rector\Class_\AnnotationToAttributeRector;
use Rector\Php80\ValueObject\AnnotationToAttribute;

return static function (RectorConfig $rectorConfig): void {
    // Paths for Rector to act upon
    $rectorConfig-&gt;paths([
        __DIR__ . '/config',
        __DIR__ . '/public',
        __DIR__ . '/src',
        __DIR__ . '/tests',
    ]);

    // Additional configuration (Rector rules) go here
};
</code></pre>
<ol start="3">
<li>Use the provided sets by Symfony &amp; Doctrine to automatically refactor all <code>@Route</code> and <code>@ORM</code> annotations to attributes.</li>
</ol>
<pre><code class="language-php">$rectorConfig-&gt;sets([
    \Rector\Doctrine\Set\DoctrineSetList::ANNOTATIONS_TO_ATTRIBUTES,
    \Rector\Symfony\Set\SymfonySetList::ANNOTATIONS_TO_ATTRIBUTES,
    \Rector\Symfony\Set\SensiolabsSetList::ANNOTATIONS_TO_ATTRIBUTES,
]);
$rectorConfig-&gt;ruleWithConfiguration(AnnotationToAttributeRector::class, [
    new AnnotationToAttribute(\Symfony\Bridge\Doctrine\Validator\Constraints\UniqueEntity::class),
    new AnnotationToAttribute(\Ibericode\Vat\Bundle\Validator\Constraints\VatNumber::class),
]);
</code></pre>
<ol start="4">
<li>Preview the suggested changes by running Rector with the <code>--dry-run</code> option.</li>
</ol>
<pre><code>vendor/bin/rector process --dry-run
</code></pre>
<ol start="5">
<li>Apply the changes.</li>
</ol>
<pre><code>vendor/bin/rector process
</code></pre>
<p>That's all there is to it. Several tedious hours of work saved by a tool that just works and can be configured within minutes. So good!</p>
<p>Rector also comes with a thing called <a href="https://getrector.com/documentation/set-lists">set lists</a> which automatically configure multiple rules for you. This can come in really handy if you want to upgrade to a new PHP level and use new language features.</p>
<pre><code>$rectorConfig-&gt;sets([\Rector\Set\ValueObject\LevelSetList::UP_TO_PHP_82]);
</code></pre>
<p>There are hundreds of available <a href="https://getrector.com/documentation/rules-overview">Rector rules</a> available. My guess is that if you're refactoring something on a language or framework level, Rector has you covered.</p>
<p>Kudos to the Rector authors for building such a great tool!</p>


</div>
</main>
<footer class="container site-footer">
    <div class="footer-col mb">
        <ul class="nolist">
            <li><a href="/about/" style="font-weight: bold; text-decoration: none;">About me</a></li>
            <li><a href="/bookmarks/">Bookmarks</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="/code/">Code</a></li>
            <li><a href="/contact/">Contact me</a></li>
        </ul>
    </div>
    <div class="footer-col mb">
        <ul class="nolist">
            <li><a href="/projects/" style="font-weight: bold; text-decoration: none;">Projects</a></li>
            <li><a href="https://www.mc4wp.com/">Mailchimp for WordPress</a></li>
            <li><a href="https://www.kokoanalytics.com/">Koko Analytics</a></li>
            <li><a href="https://www.htmlformsplugin.com/">HTML Forms plugin</a></li>
        </ul>
    </div>
    <p style="clear:both;">Find me on <a href="https://git.sr.ht/~dvko/" class="icon sourcehut" rel="me nofollow author">sourcehut</a>,
        <a href="https://github.com/dannyvankooten/" class="icon github" rel="me nofollow author">GitHub</a> and <a rel="me" href="https://toot.re/@dvk" class="icon mastodon">Mastodon</a>.
    </p>
    <p>This website is statically built using <a href="https://www.getzola.org/">Zola</a>. You can find <a href="https://git.sr.ht/~dvko/dannyvankooten.com" rel="nofollow">its source code here</a>.</p>
    <p>Pageviews for this site are counted using a standalone spin-off of Koko Analytics, code-named <a href="https://teller.dvk.co/">Teller</a>.</p>
</footer>
<script>
    ((t, cnf) => {
        window[t] = cnf;
        let s = document.createElement('script');
        s.defer = true;
        s.src = [cnf.url, '/assets/', t, '.min.js'].join('');
        document.body.appendChild(s)
    })('teller', {
        url: 'https://teller.dvk.co',
        site: '433ca337-2a49-4391-a340-e3c3bbbb32d3'
    })
</script>
</body>
</html>

